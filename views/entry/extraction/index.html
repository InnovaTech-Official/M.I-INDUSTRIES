<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>InnovaTech Bora Bag Animation</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins:wght@600&display=swap" rel="stylesheet" />
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <!-- Add select2 CSS and JS for searchable dropdown -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  
  <!-- Toastify CSS and JS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  
  <!-- CSS files with correct references -->
  <link rel="stylesheet" href="../../../assets/css/dashboard/dashboard.css">
  <link rel="stylesheet" href="../../../assets/css/entry/extraction/extraction.css">
  <link rel="stylesheet" href="../../../assets/css/entry/extraction/css-man.css">
  <link rel="stylesheet" href="../../../assets/css/entry/extraction/factory-machine.css">
  <link rel="stylesheet" href="../../../assets/css/entry/extraction/factory-machine-animations.css">
  <link rel="stylesheet" href="../../../assets/css/entry/extraction/man-machine-interaction.css">
  <link rel="stylesheet" href="../../../assets/css/entry/extraction/man-bag-interaction.css">
  <link rel="stylesheet" href="../../../assets/css/entry/bag.css">
</head>

<body>
  <nav role="navigation" aria-label="Dashboard Navigation">
    <button class="mobile-menu-btn" aria-label="Toggle menu" aria-expanded="false">
        <i class="fas fa-bars"></i>
    </button>
    <div class="nav-left">
        <button class="nav-btn" data-section="home">
            <i class="fas fa-home"></i> Home
        </button>
        <button class="nav-btn" data-section="customer">
            <i class="fas fa-users"></i> Customer
        </button>
        <button class="nav-btn" data-section="vendor">
            <i class="fas fa-building"></i> Vendor
        </button>
        <button class="nav-btn" data-section="sale">
            <i class="fas fa-shopping-cart"></i> Sale
        </button>
        <button class="nav-btn" data-section="purchase">
            <i class="fas fa-truck"></i> Purchase
        </button>
        <button class="nav-btn" data-section="salereturn">
            <i class="fas fa-undo"></i> Sale Return
        </button>
        <button class="nav-btn" data-section="purchasereturn">
            <i class="fas fa-undo-alt"></i> Purchase Return
        </button>
        <button class="nav-btn" data-section="bom">
            <i class="fas fa-clipboard-list"></i> BOM
        </button>
        <button class="nav-btn" data-section="bomlist">
            <i class="fas fa-list"></i> BOM List
        </button>
        <button class="nav-btn active" data-section="extraction">
            <i class="fas fa-filter"></i> Extraction
        </button>
        <button class="nav-btn" data-section="receivevoucher">
            <i class="fas fa-file-invoice-dollar"></i> Receive Voucher
        </button>
        <button class="nav-btn" data-section="paymentvoucher">
            <i class="fas fa-money-check"></i> Payment Voucher
        </button>
        <button class="nav-btn" data-section="expensevoucher">
            <i class="fas fa-receipt"></i> Expense Voucher
        </button>
        <button class="nav-btn" data-section="journalvoucher">
            <i class="fas fa-book"></i> Journal Voucher
        </button>
        <button class="nav-btn" data-section="setup">
            <i class="fas fa-cogs"></i> Setup
        </button>
        <button class="nav-btn" data-section="reports">
            <i class="fas fa-chart-bar"></i> Reports
        </button>
        <button class="nav-btn" data-section="hr">
            <i class="fas fa-user-tie"></i> HR
        </button>
        <button class="nav-btn" data-section="settings">
            <i class="fas fa-cog"></i> Settings
        </button>
        <button id="logout-btn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>
</nav>

  <section class="content" id="content-area">
    <h1>InnovaTech: Extraction Unit</h1>

    <div class="qty-info">
      <div>Available Qty: <span id="availableQty">0</span> KG</div>
      <div>Remaining Qty: <span id="qty">0</span> KG</div>
    </div>

    <div class="container">
      <div class="man-wrapper">
        <!-- Redesigned CSS-based man with connected body parts -->
        <div class="css-man">
          <!-- Main body structure -->
          <div class="body-core">
            <div class="head">
              <div class="hair"></div>
              <div class="eye-left"></div>
              <div class="eye-right"></div>
              <div class="eyebrow-left"></div>
              <div class="eyebrow-right"></div>
              <div class="mouth"></div>
              <div class="ear-left"></div>
              <div class="ear-right"></div>
            </div>
            <div class="neck"></div>
            <div class="torso">
              <div class="button"></div>
              <div class="button"></div>
              <div class="button"></div>
            </div>
            <div class="hips"></div>

            <!-- Limbs directly connected to the body -->
            <div class="limbs">
              <!-- Left arm with hand -->
              <div class="arm arm-left">
                <div class="upper-arm"></div>
                <div class="elbow"></div>
                <div class="forearm"></div>
                <div class="wrist"></div>
                <div class="hand">
                  <div class="thumb"></div>
                  <div class="fingers">
                    <div class="finger">
                      <div class="nail"></div>
                    </div>
                    <div class="finger">
                      <div class="nail"></div>
                    </div>
                    <div class="finger">
                      <div class="nail"></div>
                    </div>
                    <div class="finger">
                      <div class="nail"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right arm with hand -->
              <div class="arm arm-right">
                <div class="upper-arm"></div>
                <div class="elbow"></div>
                <div class="forearm"></div>
                <div class="wrist"></div>
                <div class="hand">
                  <div class="thumb"></div>
                  <div class="fingers">
                    <div class="finger">
                      <div class="nail"></div>
                    </div>
                    <div class="finger">
                      <div class="nail"></div>
                    </div>
                    <div class="finger">
                      <div class="nail"></div>
                    </div>
                    <div class="finger">
                      <div class="nail"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Left leg with enhanced bone and joint structure -->
              <div class="leg leg-left">
                <div class="thigh">
                  <div class="femur"></div>
                  <div class="thigh-muscle"></div>
                </div>
                <div class="knee">
                  <div class="patella"></div>
                  <div class="knee-ligament"></div>
                </div>
                <div class="calf">
                  <div class="tibia"></div>
                  <div class="fibula"></div>
                  <div class="calf-muscle"></div>
                </div>
                <div class="ankle">
                  <div class="joint-capsule"></div>
                </div>
                <div class="foot">
                  <div class="shoe">
                    <div class="toes">
                      <div class="toe"></div>
                      <div class="toe"></div>
                      <div class="toe"></div>
                      <div class="toe"></div>
                      <div class="toe"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right leg with enhanced bone and joint structure -->
              <div class="leg leg-right">
                <div class="thigh">
                  <div class="femur"></div>
                  <div class="thigh-muscle"></div>
                </div>
                <div class="knee">
                  <div class="patella"></div>
                  <div class="knee-ligament"></div>
                </div>
                <div class="calf">
                  <div class="tibia"></div>
                  <div class="fibula"></div>
                  <div class="calf-muscle"></div>
                </div>
                <div class="ankle">
                  <div class="joint-capsule"></div>
                </div>
                <div class="foot">
                  <div class="shoe">
                    <div class="toes">
                      <div class="toe"></div>
                      <div class="toe"></div>
                      <div class="toe"></div>
                      <div class="toe"></div>
                      <div class="toe"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Factory Machine HTML Structure -->
      <div class="factory-machine running">
        <div class="machine-body">
          <div class="machine-panel">
            <div class="control-lights">
              <div class="light light-green"></div>
              <div class="light light-yellow"></div>
              <div class="light light-red"></div>
            </div>
            <div class="control-buttons">
              <div class="button button-main"></div>
              <div class="button"></div>
            </div>
            <div class="display-screen">
              <div class="screen-content"></div>
            </div>
          </div>

          <div class="machine-components">
            <div class="gears">
              <div class="gear gear-large"></div>
              <div class="gear gear-medium"></div>
              <div class="gear gear-small"></div>
            </div>

            <div class="pistons">
              <div class="piston piston-left">
                <div class="piston-rod"></div>
                <div class="piston-head"></div>
              </div>
              <div class="piston piston-right">
                <div class="piston-rod"></div>
                <div class="piston-head"></div>
              </div>
            </div>
          </div>

          <div class="conveyor">
            <div class="conveyor-belt">
              <div class="belt-section"></div>
              <div class="belt-section"></div>
              <div class="belt-section"></div>
              <div class="belt-section"></div>
              <div class="belt-section"></div>
            </div>
            <div class="product-output">
              <div class="product-item"></div>
            </div>
          </div>

          <div class="machine-housing">
            <div class="panel-seams"></div>
            <div class="vents">
              <div class="vent vent-1"></div>
              <div class="vent vent-2"></div>
              <div class="vent vent-3"></div>
            </div>
            <div class="rivets">
              <div class="rivet rivet-1"></div>
              <div class="rivet rivet-2"></div>
              <div class="rivet rivet-3"></div>
              <div class="rivet rivet-4"></div>
            </div>
          </div>
        </div>

        <div class="machine-base">
          <div class="support-legs">
            <div class="leg leg-1"></div>
            <div class="leg leg-2"></div>
            <div class="leg leg-3"></div>
            <div class="leg leg-4"></div>
          </div>
        </div>
      </div>

      <!-- Extraction item for animation between machine and form -->
      <div class="extraction-item"></div>
    </div>

    <!-- Input fields moved to the bottom center -->
    <div class="fields-container">
      <div class="fields">
        <form id="extractionForm">
          <label for="extractionDate">Date:</label>
          <input type="date" id="extractionDate" name="extractionDate" value="" required />

          <label for="jobNo">Job No:</label>
          <div class="search-dropdown-container">
            <select id="jobNo" name="jobNo" class="searchable-select" required>
              <option value="">Select a Job No</option>
              <!-- Job options will be loaded dynamically -->
            </select>
          </div>

          <label for="machineNo">Machine No:</label>
          <input type="text" id="machineNo" name="machineNo" value="" readonly required />

          <label for="finishedGood">Finished Good:</label>
          <input type="text" id="finishedGood" name="finishedGood" value="" readonly required />

          <label for="wastage">Wastage %:</label>
          <input type="number" id="wastage" name="wastage" min="0" max="100" step="0.01" />

          <label for="extractionQty">Extraction Qty:</label>
          <input type="number" id="extractionQty" name="extractionQty" min="0" step="0.01" required />

          <!-- Hidden fields for calculation and validation -->
          <input type="hidden" id="originalQty" name="originalQty" value="0" />
          <input type="hidden" id="availableQtyHidden" name="availableQty" value="0" />
          <input type="hidden" id="wastageAmountHidden" name="wastageAmount" value="0" />

          <!-- Added buttons for extraction and navigation -->
          <div class="button-container">
            <button type="submit" id="extractButton" class="action-button extract-button">Extract</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Sound effects -->
  <audio id="plopSound" src="../../../assets/sound/plop.wav"></audio>
  <audio id="buttonClickSound" src="button-click.mp3"></audio>
  <audio id="machineHumSound" src="machine-hum.mp3"></audio>

  <!-- Add jQuery (required for Select2) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  
  <!-- Toastify JS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  
  <!-- Include common navigation script - same as dashboard -->
  <script src="../../../assets/js/common/navigation.js"></script>
  
  <!-- Other scripts -->
  <script src="../../../assets/js/entry/extraction/extraction-api.js"></script>
  <script>
    // Simple man-machine interaction
    function initManMachineInteraction() {
      const man = document.querySelector('.css-man');
      const machine = document.querySelector('.factory-machine');
      
      function startInteraction() {
        man.classList.add('machine-interaction');
        machine.classList.add('being-operated');
        
        setTimeout(() => {
          man.classList.remove('machine-interaction');
          machine.classList.remove('being-operated');
        }, 4000);
      }
      
      // Make the function available globally
      window.startManMachineInteraction = startInteraction;
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', initManMachineInteraction);
  </script>
  
  <script>
    // Factory machine JavaScript
    function initFactoryMachine() {
      const machine = document.querySelector('.factory-machine');
      const mainButton = document.querySelector('.button-main');
      
      if (mainButton) {
        mainButton.addEventListener('click', function() {
          machine.classList.toggle('running');
        });
      }
    }
    
    document.addEventListener('DOMContentLoaded', initFactoryMachine);
  </script>
  
  <script>
    // JavaScript to initialize machine state
    document.addEventListener('DOMContentLoaded', function () {
      const machine = document.querySelector('.factory-machine');

      // Set the date field to today's date by default
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      const formattedDate = `${yyyy}-${mm}-${dd}`;
      document.getElementById('extractionDate').value = formattedDate;

      // Initialize Select2 for searchable dropdown
      $('.searchable-select').select2({
        placeholder: "Select a Job No",
        allowClear: true
      });
      
      // Load jobs from the API
      loadJobs();
      
      // Handle form submission
      $('#extractionForm').on('submit', function(e) {
        e.preventDefault();
        
        // Start man-machine interaction animation
        if (typeof window.startManMachineInteraction === 'function') {
          window.startManMachineInteraction();
        }
        
        // Save the extraction data
        saveExtraction();
      });
      
      // Handle job selection change
      $('#jobNo').on('change', function() {
        const jobNo = $(this).val();
        if (jobNo) {
          loadMachineDetails(jobNo);
        } else {
          $('#machineNo').val('');
          $('#finishedGood').val('');
          $('#qty').text('0');
          $('#originalQty').val('0');
          $('#extractionQty').attr('max', 0);
          $('#extractionQty').attr('placeholder', 'Max: 0');
        }
      });
      
      // Add event listeners for real-time quantity calculation
      $('#wastage, #extractionQty').on('input', function() {
        calculateRemainingQty();
      });
    });
  </script>
</body>

</html>